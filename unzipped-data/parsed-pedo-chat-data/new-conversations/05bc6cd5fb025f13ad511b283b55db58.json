{
    "id": "05bc6cd5fb025f13ad511b283b55db58",
    "messages": [
        "104bc19e5513cba4eba2d18c7a704a01 (01:21): 3aa4c68c2ceb0521f6c25f50e2e0950e, do you have blur radius tests anywhere?",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:22): I have some custom tests that rely on taking a screenshot of the browser's rendering, chopping it appropriately, then using it with &lt;canvas&gt;.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:23): wishes he could do screengrabs from &lt;canvas&gt;, as it would make these super-easy.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:26): so I changed our radius calculation, but I can't actually see the difference on",
        "104bc19e5513cba4eba2d18c7a704a01 (01:26): http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0A%3Cstyle%3E%0Ap%20{%0Aheight%3A%20100px%3B%0Awidth%3A%20100px%3B%0Abackground%3A%20blue%3B%0A-moz-box-shadow%3A%20100px%200%20100px%20green%3B%0A}%0A%0A%3C%2Fstyle%3E%0A%3Cp%3E",
        "104bc19e5513cba4eba2d18c7a704a01 (01:29): though apparently I should have increased the blur by a factor of 2.81",
        "104bc19e5513cba4eba2d18c7a704a01 (01:30): Does it sound right that Gecko's blur was 2.81x too small?",
        "104bc19e5513cba4eba2d18c7a704a01 (01:30): oh, wait, sorry",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:30): Uh, I don't think so.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:30): 1.40x",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:31): Yeah, that's about right I think.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:31): can't recall exactly what the old blur results were.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:32): so apparently I can't see the different for a 1.4x change in blur radius",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:32): If you can get me a screenshot of a complete blur where the original shadow edge is in the exact center, I can run it through my comparison test.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:33): what size blur?",
        "104bc19e5513cba4eba2d18c7a704a01 (01:33): something like '-moz-box-shadow: 50px 50px 100px green'?",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:34): Yeah, that'll work.  Prefer a black shadow, just so I have to change less.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:35): ok, I'll use http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0A%3Cstyle%3E%0Ap%20%7B%0Aheight%3A%20100px%3B%0Awidth%3A%20100px%3B%0A-moz-box-shadow%3A%2050px%2050px%20100px%20black%3B%0A%7D%0A%0A%3C%2Fstyle%3E%0A%3Cp%3E",
        "104bc19e5513cba4eba2d18c7a704a01 (01:37): 3aa4c68c2ceb0521f6c25f50e2e0950e, http:/ 104bc19e5513cba4eba2d18c7a704a01.org/tmp/newblur.png",
        "104bc19e5513cba4eba2d18c7a704a01 (01:38): there's stuff visible past the radius, though, so I'm wondering if that's wrong",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:38): Cool, gimme a sec and I'll get the test set up.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:38): And compare it to current FF's rendering too.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:38): I think it might be a factor of 3/2 too large, though",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:39): What value does your graphics library take as input?",
        "104bc19e5513cba4eba2d18c7a704a01 (01:39): it's a box blur parameter",
        "104bc19e5513cba4eba2d18c7a704a01 (01:39): there's code to compute that box blur param from a standard deviation",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:39): kk",
        "104bc19e5513cba4eba2d18c7a704a01 (01:39): and the formula that code implements differs from what's in the SVG spec by a factor of 3/2",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:40): Interesting.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:41): Yeah, that looks too big.  There shouldn't be anything immediately visible out past 100px.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:43): that means we're wrong by 3/2 for our &lt;canvas&gt; impl",
        "104bc19e5513cba4eba2d18c7a704a01 (01:43): and wrong by 0.94 for our text-shadow/box-shadow impl",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:43): Interesting.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:52): oh, except our canvas impl has another bug",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:52): Hrm, I forgot that my current compare code is only doing a 1d blur.  Could I have you do a different screenshot so I don't have to make any significant (and untested) edits to my code?",
        "104bc19e5513cba4eba2d18c7a704a01 (01:53): 3aa4c68c2ceb0521f6c25f50e2e0950e, 1d?",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:53): As opposed to a 2d blur.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:54): With gaussians it doesn't matter which one you test, since a 2d gaussian is just two 1d gaussians run in series.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:54): ah, ok, so I'll send you a screenshot of http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0A%3Cstyle%3E%0Ap%20%7B%0Aheight%3A%201000px%3B%0Awidth%3A%20100px%3B%0A-moz-box-shadow%3A%2050px%2050px%20100px%20black%3B%0A%7D%0A%0A%3C%2Fstyle%3E%0A%3Cp%3E",
        "104bc19e5513cba4eba2d18c7a704a01 (01:54): once I fix this",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:55): Yeah, that's perfect.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:56): ok, so now I have one change to our canvas code, one change to our box-shadow/text-shadow code, and one change to the graphics library that both use",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (01:56): Awesome.",
        "104bc19e5513cba4eba2d18c7a704a01 (01:56): I'd like to try to multiply this out to see what the changes are.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:04): actually, I think I really want http://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0A%3Cstyle%3E%0Ap%20%7B%0Aheight%3A%201000px%3B%0Awidth%3A%20100px%3B%0A-moz-box-shadow%3A%2050px%20100px%20100px%20black%3B%0A%7D%0A%0A%3C%2Fstyle%3E%0A%3Cp%3E",
        "104bc19e5513cba4eba2d18c7a704a01 (02:04): and maybe that 3/2 was ok, though",
        "104bc19e5513cba4eba2d18c7a704a01 (02:04): but maybe not",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:04): Yeah, that's fine, since it shows the whole thing.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:04): Do you want me to quickly produce a &quot;correct&quot; rendering for you in canvas?",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:05): Well, actually, you can do that yourself - www.xanthir.com/etc/blurplay",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:05): Just feed it a sigma and it shows you the gaussian, with red bars marking where the 2% point is hit on either side.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:08): 3aa4c68c2ceb0521f6c25f50e2e0950e, btw, the example in the spec could really use some |&lt;-----&gt;| showing where the spread radius and blur radius are",
        "104bc19e5513cba4eba2d18c7a704a01 (02:09): in particular, it would help to know whether the band marked &quot;Blur radius applied&quot; is width blur-radius or width 2*blur-radius",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:12): ok",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:12): (brad made those diagrams)",
        "104bc19e5513cba4eba2d18c7a704a01 (02:20): Anyway, I think the summary of my changes to follow the various formulae means that:",
        "104bc19e5513cba4eba2d18c7a704a01 (02:20): * canvas blurs 8px or smaller will shrink by 0.667",
        "104bc19e5513cba4eba2d18c7a704a01 (02:20): * canvas blurs larger than 8px will shrink by 0.943",
        "104bc19e5513cba4eba2d18c7a704a01 (02:20): * text-shadow and box-shadow blurs will shrink by 0.940",
        "104bc19e5513cba4eba2d18c7a704a01 (02:37): 3aa4c68c2ceb0521f6c25f50e2e0950e, based on your simulation I think Mozilla's shadows are too small by at least a factor of 2",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:38): Remember, my page takes a sigma, not a blur radius.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:39): 3aa4c68c2ceb0521f6c25f50e2e0950e, yeah, I divided the blur radius by 2",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:39): K, cool.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:39): 3aa4c68c2ceb0521f6c25f50e2e0950e, but it looks like I need to divide it by 4 to get an equivalent",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:39): Huh.  You've got some really weird input value, then.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:40): 3aa4c68c2ceb0521f6c25f50e2e0950e, I'm using a blur radius of 100",
        "104bc19e5513cba4eba2d18c7a704a01 (02:40): which looks like a sigma of 25 in your demo",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:40): I meant that whatever you plug your numbers into accepts some weird value.",
        "3aa4c68c2ceb0521f6c25f50e2e0950e (02:43): I know that CG just takes a sigma.  I think that Skia does too, though its blur isn't very close to a gaussian.",
        "104bc19e5513cba4eba2d18c7a704a01 (02:43): we have a handwritten box blur impl"
    ],
    "person_ids": [
        "104bc19e5513cba4eba2d18c7a704a01",
        "3aa4c68c2ceb0521f6c25f50e2e0950e"
    ]
}