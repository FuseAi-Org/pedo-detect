{
    "id": "27c60f9f8c3e237ac99d6233b28d3916",
    "messages": [
        "88d4d34a8064a4ff39fd5e144eea7762 (04:25): . . . that just leaves the fact that named entities are syntax errors.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:27): Okay, so apparently if you use &lt;!DOCTYPE html&gt;, named entities become XML well-formedness errors, so it's impossible to use XMLHttpRequest.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:27): This seems like a pretty significant problem.  Is there any way around it?  If not, can some other kind of doctype be allowed that doesn't trigger it?",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:28): looks at Hixie",
        "65325d50b2e25aca54bc871b89758c9c (04:28): or don't use named entities",
        "65325d50b2e25aca54bc871b89758c9c (04:28): or don't use XML, and just parse your results as HTML (for example by putting in an iframe)",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:28): Okay, let's assume that I'm not willing to find every single use of named entities in an application that's several hundred thousand LOC with gigabytes of content in the database.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:29): So you're saying don't use XHR, make people use &lt;iframe&gt;s instead?",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:29): Surely that must have some disadvantages?  To begin with, it breaks all legacy codebases that expect XHR to work, so it's sort of out of the question for me right now.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:29): I thought &lt;!doctype html&gt; was chosen so that it had no significant compat issues.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:30): It seems like there's no way to have a valid HTML5 document that contains a named entity and works with XHR?",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:30): doesn't the spec allow HTML4 and XHTML1 doctypes too?",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:31): a9b326df4e6da61c5b6f5e1058be83a2, doesn't seem like it: http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html#the-doctype",
        "65325d50b2e25aca54bc871b89758c9c (04:31): it makes them work - I don't think it makes them conforming",
        "65325d50b2e25aca54bc871b89758c9c (04:31): 88d4d34a8064a4ff39fd5e144eea7762: you could use XHR and inject into an iframe to get HTML parsing, is what I'm saying",
        "65325d50b2e25aca54bc871b89758c9c (04:32): 88d4d34a8064a4ff39fd5e144eea7762: I don't think anyone though of the compat issue around named entities, and in fact what browsers do there for XML is weird",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:32): So in other words do XHR, but instead of using requestXML, create an iframe and stick requestText into its innerHTML or such.",
        "65325d50b2e25aca54bc871b89758c9c (04:32): yeah",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:32): the conforming-but-obsolete section allows them, I think",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:32): or did",
        "65325d50b2e25aca54bc871b89758c9c (04:32): although if it were me I would sooner sacrifice HTML5 conformance in the XHR-transmitted content than do that",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:33): Well, consider this some real-world experience with trying to move to HTML5.  It lasted under two hours before being disabled due to blocker compatibility problems.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:33): 65325d50b2e25aca54bc871b89758c9c, yep.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:33): Of course, XHR-transmitted content is potentially any page on the site, so.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:33): Oh, hmm: http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#obsolete-permitted-doctype",
        "65325d50b2e25aca54bc871b89758c9c (04:34): is processing XHTML via XHR a common use case? (I have no idea)",
        "65325d50b2e25aca54bc871b89758c9c (04:34): I guess any XHTML you send as XML, if you have to fix entities, that's a big stumbling block to migrating",
        "65325d50b2e25aca54bc871b89758c9c (04:34): file a bug IMO",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:34): 65325d50b2e25aca54bc871b89758c9c, I know it took less than thirty minutes for me to receive a report of a widely-used tool on Wikipedia breaking.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:34): I was thinking I'd post to the list.",
        "65325d50b2e25aca54bc871b89758c9c (04:35): oh, obsolete permitted doctype",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:35): a bug on this would be great",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:35): In the W3C bug tracker?  I'm not sure I have an account.",
        "65325d50b2e25aca54bc871b89758c9c (04:35): do those trigger a warning or error? it's not clear",
        "1f8387eb43f131d7c309a90a4e36b5cb (04:35): 88d4d34a8064a4ff39fd5e144eea7762: XHR will parse HTML properly in the future.  It's there in the XHR2 spec.",
        "65325d50b2e25aca54bc871b89758c9c (04:35): anyone can make a W3C bugzilla account",
        "65325d50b2e25aca54bc871b89758c9c (04:35): same as any other bugzilla",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:36): 65325d50b2e25aca54bc871b89758c9c, it says obsolete but conforming, so I assume that means it's conforming.",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:36): 88d4d34a8064a4ff39fd5e144eea7762: http://www.w3.org/Bugs/Public/",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:37): yeah, that obsolete-permitted-doctype thing is only in the full (implementor) view",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:37): not in the author view",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:37): seems like it should be in the Writing HTML section too",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:38): anyway, I think the intent was for those to trigger a warning, not an error",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:38): I don't think v.nu has been updated yet to reflect that",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:40): yeah, section 12.1.1 explicitly says they should trigger warnings",
        "1f58faf0d058f303f30239a369808167 (04:46): is wondering if html5 mandates Accept headers depending on the tag (html) or property (css) used.",
        "1f58faf0d058f303f30239a369808167 (04:46): for now, it's kind of nightmarish and create issues for Web development.",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:55): http://www.w3.org/Bugs/Public/show_bug.cgi?id=8268",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:56): Okay, I'm going to bed.",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:56): 1f58faf0d058f303f30239a369808167: example?",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:56): 88d4d34a8064a4ff39fd5e144eea7762: thanks man",
        "a9b326df4e6da61c5b6f5e1058be83a2 (04:56): (for filing the bug)",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:57): Shall I post to the list too?",
        "88d4d34a8064a4ff39fd5e144eea7762 (04:57): Not many people follow Bugzilla.",
        "1f58faf0d058f303f30239a369808167 (05:02): a9b326df4e6da61c5b6f5e1058be83a2: once/when the html file is downloaded by the browser, other resources are being requested by an HTTP GET",
        "1f58faf0d058f303f30239a369808167 (05:02): Let's say in the case of IMG",
        "1f58faf0d058f303f30239a369808167 (05:03): &lt;img src=&quot;http://example.net/toto&quot;/&gt;",
        "a9b326df4e6da61c5b6f5e1058be83a2 (05:03): 1f58faf0d058f303f30239a369808167: ah, content negotation stuff?",
        "1f58faf0d058f303f30239a369808167 (05:04): Firefox sends Accept: image/png,image/*;q=0.8,*/*;q=0.5",
        "1f58faf0d058f303f30239a369808167 (05:04): which is cool",
        "1f58faf0d058f303f30239a369808167 (05:04): but webkit seems to send &quot;*/*&quot;",
        "a9b326df4e6da61c5b6f5e1058be83a2 (05:05): nods",
        "1f58faf0d058f303f30239a369808167 (05:05): and Opera",
        "1f58faf0d058f303f30239a369808167 (05:05): and Opera text/html, application/xml;q=0.9, application/xhtml+xml, application/x-obml2d, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1",
        "41d47f0cdea72d061075f1a8bcd596e2 (05:05): 1f58faf0d058f303f30239a369808167: you should see what some mobile browsers send. that will kill you on the spot :D",
        "1f58faf0d058f303f30239a369808167 (05:05): the issue popped up last week end in a real case",
        "1f58faf0d058f303f30239a369808167 (05:06): and killed one of our site",
        "1f58faf0d058f303f30239a369808167 (05:06): The &lt;img src=&quot;http://example.net/toto&quot;/&gt; was on a very high trafic Web site.",
        "1f58faf0d058f303f30239a369808167 (05:07): unfortunately the URI was an html resource and not an image.",
        "1f58faf0d058f303f30239a369808167 (05:07): ooops",
        "1f58faf0d058f303f30239a369808167 (05:07): s/and not an image/but an image/",
        "1f58faf0d058f303f30239a369808167 (05:07): rha",
        "1f58faf0d058f303f30239a369808167 (05:07): tired",
        "1f58faf0d058f303f30239a369808167 (05:07): unfortunately the URI was an html resource and not an image.",
        "1f58faf0d058f303f30239a369808167 (05:08): so the little site sent thousands of html file by minutes",
        "1f58faf0d058f303f30239a369808167 (05:08): and eventually died",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:09): What does Accept have to do with this?",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:09): Do web servers even pay attention to Accept in normal configuration?",
        "1f58faf0d058f303f30239a369808167 (05:09): One of the way to avoid it would have been when you see this &quot;Accept: image/*&quot; and the URI is known to be html, reply with a &quot;406 Not Acceptable&quot;",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:10): Mostly things just ignore content negotiation.",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:10): Probably better to, um, not put a large HTML page as an image src?",
        "1f58faf0d058f303f30239a369808167 (05:10): 88d4d34a8064a4ff39fd5e144eea7762: the big site with high trafic was not under the control of the little guy.",
        "1f58faf0d058f303f30239a369808167 (05:11): Basically it creates a (not voluntary) DDOS",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:11): So I guess your point is that forums and so on allow people to post &lt;img&gt;, so people could do that maliciously on a really big file.",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:11): Thus DDoS.",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:11): Interesting thought.",
        "1f58faf0d058f303f30239a369808167 (05:11): :)",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:11): I dunno if Accept is the way to do it.",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:12): Maybe ask some browser vendors why they have */* at the end there instead of image/*.",
        "1f58faf0d058f303f30239a369808167 (05:12): Accept could have been a way but not in the state of implementations so far",
        "1f58faf0d058f303f30239a369808167 (05:13): in Rails it took only 2 minutes to implement the method to filter on the Accept and URI combinations, but was working  only with firefox",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:15): sends an e-mail to the list about his doctype issue",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:16): Oh, looks like a9b326df4e6da61c5b6f5e1058be83a2 echoed it to public-html already.",
        "88d4d34a8064a4ff39fd5e144eea7762 (05:16): Oh well."
    ],
    "person_ids": [
        "88d4d34a8064a4ff39fd5e144eea7762",
        "65325d50b2e25aca54bc871b89758c9c",
        "a9b326df4e6da61c5b6f5e1058be83a2",
        "1f8387eb43f131d7c309a90a4e36b5cb",
        "1f58faf0d058f303f30239a369808167",
        "41d47f0cdea72d061075f1a8bcd596e2"
    ]
}