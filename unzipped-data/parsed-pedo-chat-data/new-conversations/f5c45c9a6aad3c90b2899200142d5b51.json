{
    "id": "f5c45c9a6aad3c90b2899200142d5b51",
    "messages": [
        "98b94e5cd9b265939c3c40c3f86acd80 (14:16): be more specific",
        "c3568d0d6c11b843519416fe288a8668 (14:24): /dev/null&quot;)",
        "b26736415f5b6ef9fb520af61612536b (14:32): Hi, I want to use the ULOG target to log new connections to a file. But i only want to log them if the connection succeeds, 'state new' logs all connection attempts (like scans etc) but I want to filter them and only log the ones that work. What state can I best log ?",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:34): ESTABLISHED",
        "d949efae795da71ef603b60b018d191c (14:34): ESTABLISHED is the state of the TCP connection - it could also be FIN_WAIT or other things",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:38): (but then you got every session packets matched)",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:42): henk: or you could probably match at OUTPUT packets with SYN,ACK armed",
        "b26736415f5b6ef9fb520af61612536b (14:45): ok I'll try the EST type thnx",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:45): you'll get bunch of log lines with that one",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:45): you only want the first one",
        "b26736415f5b6ef9fb520af61612536b (14:45): o wait indeed that will log all the packets...",
        "b26736415f5b6ef9fb520af61612536b (14:45): hmm",
        "661186e835f2d517077443e282a4a42a (14:45): maybe check for NEW and ESTABLISHED",
        "661186e835f2d517077443e282a4a42a (14:45): and log tha",
        "661186e835f2d517077443e282a4a42a (14:45): t",
        "b26736415f5b6ef9fb520af61612536b (14:46): yes, I want to know all succeeded connections",
        "b26736415f5b6ef9fb520af61612536b (14:46): wil new &amp; est exist at the same time?",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:46): oh the flood",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:49): (I guess the comma is like a logical OR)",
        "98b94e5cd9b265939c3c40c3f86acd80 (14:50): henk: no, if you check in OUTPUT for ESTABLISHED then that is fine",
        "98b94e5cd9b265939c3c40c3f86acd80 (14:50): as long as its in the filter table",
        "98b94e5cd9b265939c3c40c3f86acd80 (14:50): states actually change in the mangle table for OUTPUT",
        "98b94e5cd9b265939c3c40c3f86acd80 (14:50): for locally genereated packets that is",
        "b26736415f5b6ef9fb520af61612536b (14:54): hmm but I want to log both new succesfull incomming and outgoing connections... If I only check the outgoing for the EST than i think i'll only find new incomming connections",
        "b26736415f5b6ef9fb520af61612536b (14:55): o and the connections are made by interfaces on a bridge, currently I find them with PHYSDEV",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (14:55): is the SYN,ACK match not okay ?",
        "98b94e5cd9b265939c3c40c3f86acd80 (15:19): i would personally just do:  iptables -A INPUT -i &lt;iface&gt; -p tcp -m state --state ESTABLISHED,RELATED -m limit --limit 10/minute -j ULOG",
        "673d7d497cb7c30e46ce951bc321aafd (15:19): matth_: take a look at BADTCP at <a href=\"http://www.tbg.nu/iptables.txt\">http://www.tbg.nu/iptables.txt</a>",
        "98b94e5cd9b265939c3c40c3f86acd80 (15:19): and then the same exact rule under that but -j ACCEPT",
        "98b94e5cd9b265939c3c40c3f86acd80 (15:20): acutally thats going to log all traffic isnt it",
        "98b94e5cd9b265939c3c40c3f86acd80 (15:21): well you could use the recent match, using NEW to add it to the recent table, then use ESTABLISHED to log",
        "b26736415f5b6ef9fb520af61612536b (15:39): the syn+ack seems to work",
        "b26736415f5b6ef9fb520af61612536b (15:40): but it looses the information on the port that was connected too",
        "b26736415f5b6ef9fb520af61612536b (15:41): or will the SRC port now be the port that tells me what port is in use",
        "b26736415f5b6ef9fb520af61612536b (15:43): hmm seems to be so... ok I think this will give me the info I need. Thanks people!",
        "13fbb6cc9f88ccfc50845bb81132b4d4 (15:49): of course that's not perfect but probably a simple 'workaround' to the initial problem",
        "235ea3ef46f8abdebab7fca6691fd6f2 (15:57): hello",
        "d949efae795da71ef603b60b018d191c (15:57): bonjour, bodq.",
        "235ea3ef46f8abdebab7fca6691fd6f2 (15:57): I have a WEIRD PROBLEM",
        "235ea3ef46f8abdebab7fca6691fd6f2 (15:59): I have a router which doesn't forward some packets for hosts in /24 network, but does forward packets for other hosts. it seems the behaviour is determined by DST address, as in different for hosts in same subnet",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:00): s/as in/and is/",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:00): to make it simple, from remote host - ping x.y.z.15 works, and ping x.y.z.14 does not. everything works from the router side",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:02): I've been adding LOG rules to iptables (which were EMPTY), and discovered that pachets appear in PREROUTING but not in FORWARD",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:03): and I'm not getting any ICMP errors for that packets",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:03): how can I debug this?",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:03): rp_filter is of, forwarding is on",
        "235ea3ef46f8abdebab7fca6691fd6f2 (16:03): firewall contains only rules with LOG targets",
        "d770d01baf68068d340c8ab95d251419 (16:04): hello",
        "d949efae795da71ef603b60b018d191c (16:04): hola, mariooliveira.",
        "d770d01baf68068d340c8ab95d251419 (16:05): hola",
        "d770d01baf68068d340c8ab95d251419 (16:06): i need to execute an iptables command as root",
        "d770d01baf68068d340c8ab95d251419 (16:06): with other user",
        "d770d01baf68068d340c8ab95d251419 (16:07): execute a script as root user",
        "d770d01baf68068d340c8ab95d251419 (16:07): to change iptables firewall",
        "d770d01baf68068d340c8ab95d251419 (16:09): i think everybody is sleeping lol",
        "d949efae795da71ef603b60b018d191c (16:09): i already had it that way, mariooliveira.",
        "d770d01baf68068d340c8ab95d251419 (16:09): maxine, ??",
        "d949efae795da71ef603b60b018d191c (16:09): i haven't a clue, mariooliveira",
        "d770d01baf68068d340c8ab95d251419 (16:09): :)"
    ],
    "person_ids": [
        "98b94e5cd9b265939c3c40c3f86acd80",
        "c3568d0d6c11b843519416fe288a8668",
        "b26736415f5b6ef9fb520af61612536b",
        "13fbb6cc9f88ccfc50845bb81132b4d4",
        "d949efae795da71ef603b60b018d191c",
        "661186e835f2d517077443e282a4a42a",
        "673d7d497cb7c30e46ce951bc321aafd",
        "235ea3ef46f8abdebab7fca6691fd6f2",
        "d770d01baf68068d340c8ab95d251419"
    ]
}