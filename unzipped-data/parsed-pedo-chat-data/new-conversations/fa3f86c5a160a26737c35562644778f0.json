{
    "id": "fa3f86c5a160a26737c35562644778f0",
    "messages": [
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:54): hi. can't get -m recent to work",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:54): tried this:",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:54): iptables -A INPUT  -p tcp -dport http --syn -m recent --name http_conns --update --seconds 10 --hitcount 1 -j DROP",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:54): I expected it to limit 1 http connection per 10 seconds",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:54): but it doesn't",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:55): what's wrong?",
        "5f05b3ded4139f6a691da91429a957b9 (02:55): Is that the only rule you have?",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:56): no, but it's placed correctly in the chain, if that's what you mean",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:56): that's the only -m recent rule",
        "5f05b3ded4139f6a691da91429a957b9 (02:57): iptables -A INPUT -p tcp --dport http --syn -m recent --set --name http_conns -j ACCEPT",
        "5f05b3ded4139f6a691da91429a957b9 (02:57): after the rule you have",
        "5f05b3ded4139f6a691da91429a957b9 (02:57): Bear in mind: I don't think you really want what you think you want, but...",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:58): ok, I tried to place it first in chain... iptables -I INPUT 1 ......",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:58): doesn't work either",
        "5f05b3ded4139f6a691da91429a957b9 (02:58): the --update rule must be first, the --set rule second",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:58): what do you mean that I don't want what you think I want?",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:59): I didn't insert a --set rule because of what the tutorial above says",
        "5f05b3ded4139f6a691da91429a957b9 (02:59): It doesn't matter - if it works for you, then fine",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:59): &quot;This match is true if the source combination is available in the specified list and it also updates the last-seen time in the list. &quot;",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (02:59): it doesn't work",
        "5f05b3ded4139f6a691da91429a957b9 (03:00): Yeah, but if the list doesn't exist because you didn't create it, then what?",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:00): ops, true embarassing",
        "5f05b3ded4139f6a691da91429a957b9 (03:01): :)",
        "5f05b3ded4139f6a691da91429a957b9 (03:01): Good luck; I'm heading home :)",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:01): however, the doc doesn't specify that --set creates the list and --update doesn't",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:02): $IPTABLES -t nat -A CHECK_RECENT -m recent --update --seconds 15 -m limit --limit 2/second --limit-burst 5 -j ULOG --ulog-prefix &quot;[RECENT DROP]: &quot;",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:02): $IPTABLES -t nat -A CHECK_RECENT -m recent --update --seconds 15 -j DROP",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:02): im thinking I shouldnt use the --update on the LOG rule",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:03): probably not a big deal but unnecessary i think",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:05): i basically use this method so that if i want to limit consecutive hits on another port i just need to add it to the 1st rule with the multiport match--&gt; <a href=\"http://rafb.net/paste/results/hzwoXl23.html\">http://rafb.net/paste/results/hzwoXl23.html</a>",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:05): its sorta like a pre-filtering",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:06): i still may drop it later on even if it passes that test",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:08): oki... I added a --set after the --update, it works, but the iptables counters for the DROP (--update) rule I typed above are set to 0, although abviously new conns are being dropped because of it",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:08): no, sorry wrong, I forgot to erase the -I INPUT 1 I inserted before to test",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:08): everything's ok, thanks.",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:13): i wonder what ! --update or ! --remove does",
        "398f2bbd2b282c39c6500c2395ba56d5 (03:14): ! --rcheck makes sense",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:15): I guess that remove just searches for IP in list, if it doesn't find it then it removes it",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:15): xD",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:16): no, maybe it makes more sense, if it affects its return value",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:16): by the way, I haven't used multiple -m in single rule, but what does it do? AND or OR the results??",
        "2a0be8d62ca9580cd38315202869a51a (03:22): any of you ever use the ROUTE target for iptables?  I'm getting &quot;Unknown arg `--gw'&quot; which the man page says is valid.  but I don't see a ipt_ROUTE module, maybe thatis why?",
        "2a0be8d62ca9580cd38315202869a51a (03:24): I guess I should use the mangle/-j MARK method, but I saw the ROUTE target there in man page and it looked like it did just what i wanted to do, :)",
        "842c224c189130c3429ed776e02bae7d (03:30): ROUTE target is in pom",
        "2a0be8d62ca9580cd38315202869a51a (03:31): what is &quot;pom&quot;?",
        "842c224c189130c3429ed776e02bae7d (03:31): <a href=\"http://netfilter.org/projects/patch-o-matic/pom-extra.html#pom-extra-ROUTE\">http://netfilter.org/projects/patch-o-matic/pom-extra.html#pom-extra-ROUTE</a>",
        "2a0be8d62ca9580cd38315202869a51a (03:32): netfilter.org needs a search option, :)",
        "2a0be8d62ca9580cd38315202869a51a (03:32): thanks",
        "2a0be8d62ca9580cd38315202869a51a (03:34): incidentally, unrelated issue, I was rewriting my firewall script and was wondering if doing stuff like this is sane:",
        "2a0be8d62ca9580cd38315202869a51a (03:34): iptables -A PREROUTING -t nat -j DNAT -m multiport -p tcp -i $DMZ_IF -d $TUNNEL --to $REI_INT:22 --dports 22,80,443",
        "2a0be8d62ca9580cd38315202869a51a (03:34): essentailyl just aggregating multiple port forwarding rules into one rule if they all end up at the same place",
        "2a0be8d62ca9580cd38315202869a51a (03:35): my testnig faile dmiserably, though, and I had to revert to old script before I messed up our network for too long, :)",
        "33d9f0b2dcb9348449e56dbebf6bb7dc (03:35): bye, night people, and thanks again for helping.",
        "842c224c189130c3429ed776e02bae7d (03:37): dkr: you better use -m multiport, see the man for more info",
        "2a0be8d62ca9580cd38315202869a51a (03:37): I did",
        "2a0be8d62ca9580cd38315202869a51a (03:38): incidentally, -m mport didn't work as the man page indicated it would.  I had to spel out multiport(even after symlinking or copying the library to the shorter name)",
        "842c224c189130c3429ed776e02bae7d (03:39): what's in the man does not reflect your conf",
        "2a0be8d62ca9580cd38315202869a51a (03:40): that turns out to be a distro issue. my debian server has ipt_mport, but not my ubuntu or fedora boxes",
        "51d4dc07498e444e94172382e05375a8 (03:41): hi. i run iptables on a linksys router.  for along time, i've used rules such as:",
        "51d4dc07498e444e94172382e05375a8 (03:41): iptables -v -A INPUT  -i ppp0 -p tcp -m tcp  -m multiport  --dports 445,554,901,111,4899,1080,8000  -j DROP",
        "51d4dc07498e444e94172382e05375a8 (03:41): after a recent firmware upgrade, that same rule now reports:",
        "51d4dc07498e444e94172382e05375a8 (03:41): DROP  tcp opt -- in ppp0 out *  0.0.0.0/0  -&gt; 0.0.0.0/0  tcp multiport dports 445,554,901,111,4899,1080,8000",
        "51d4dc07498e444e94172382e05375a8 (03:41): iptables: Unknown error -1",
        "51d4dc07498e444e94172382e05375a8 (03:41): any advice what to do / where to start looking?",
        "2a0be8d62ca9580cd38315202869a51a (03:42): -pm tcp?  shouldn't that be -p tcp",
        "2a0be8d62ca9580cd38315202869a51a (03:42): er, -m tcp",
        "2a0be8d62ca9580cd38315202869a51a (03:43): oh, nevermind, -m tcp is just redundant because -p tcp already loads the tcp module.  obviously not source of the problem",
        "89d335ace62763c104082ee1becef58a (03:44): OpenMacNews: Tried without -v?",
        "51d4dc07498e444e94172382e05375a8 (03:44): TmBerg: sure.  w/o &quot;-v&quot; it still fails, but simply reports:",
        "51d4dc07498e444e94172382e05375a8 (03:44): Unknown error -1",
        "2a0be8d62ca9580cd38315202869a51a (03:44): -vv ? :)",
        "51d4dc07498e444e94172382e05375a8 (03:45): dkr:",
        "51d4dc07498e444e94172382e05375a8 (03:45): DROP  tcp opt -- in ppp0 out *  0.0.0.0/0  -&gt; 0.0.0.0/0  tcp multiport dports 445,554,901,111,4899,1080,8000",
        "51d4dc07498e444e94172382e05375a8 (03:45): iptables: Unknown error -1",
        "51d4dc07498e444e94172382e05375a8 (03:46): many/most of my other rules still fire ok .... e.g.:",
        "51d4dc07498e444e94172382e05375a8 (03:46): iptables -A FORWARD  -i ppp0 -p tcp -m tcp  --dport 135:139  -j DROP",
        "51d4dc07498e444e94172382e05375a8 (03:46): is fine.",
        "51d4dc07498e444e94172382e05375a8 (03:46): did, perchance, recent updates/changes to iptables change anything with multiport/dports options?",
        "2a0be8d62ca9580cd38315202869a51a (03:46): The exit code is 0  for  correct  func\u201a\u00c4\u00ea",
        "2a0be8d62ca9580cd38315202869a51a (03:46): tioning.   Errors which appear to be caused by invalid or abused command line parameters cause",
        "2a0be8d62ca9580cd38315202869a51a (03:46): an exit code of 2, and other errors cause an exit code of 1",
        "2a0be8d62ca9580cd38315202869a51a (03:47): oh, but return code is different from printing out -1.  what is return code?",
        "2a0be8d62ca9580cd38315202869a51a (03:47): echo $?  after the itpables command",
        "51d4dc07498e444e94172382e05375a8 (03:48): dkr:",
        "51d4dc07498e444e94172382e05375a8 (03:48): % echo $?",
        "51d4dc07498e444e94172382e05375a8 (03:48): 1",
        "2a0be8d62ca9580cd38315202869a51a (03:48): &quot;other erro&quot;, of course, lol",
        "51d4dc07498e444e94172382e05375a8 (03:48): ( /me feels picked on by the universe today ... snifff ... sob ...)",
        "2a0be8d62ca9580cd38315202869a51a (03:49): try it without multiport: perhaps try the same command to drop --dport 445",
        "2a0be8d62ca9580cd38315202869a51a (03:49): that will at least confirm whether that is part of the problem",
        "51d4dc07498e444e94172382e05375a8 (03:49): dkr:",
        "51d4dc07498e444e94172382e05375a8 (03:49): iptables -A INPUT  -i ppp0 -p tcp -m tcp  --dport 445  -j DROP",
        "51d4dc07498e444e94172382e05375a8 (03:49): works fine. hmmm ...",
        "51d4dc07498e444e94172382e05375a8 (03:50): i'm no expert by any stretch ....but do i remember correctly that multiport is a 'module' that needs to be loaded, or some such?",
        "2a0be8d62ca9580cd38315202869a51a (03:50): ipt_multiport kernel module is loaded, right?",
        "51d4dc07498e444e94172382e05375a8 (03:50): hah.",
        "2a0be8d62ca9580cd38315202869a51a (03:50): yeah, check with lsmod",
        "2a0be8d62ca9580cd38315202869a51a (03:51): I think you woul dget error about --dports not recognized if that were the case, though",
        "51d4dc07498e444e94172382e05375a8 (03:51): well, assuming i'm checking correctly --&gt; nada",
        "51d4dc07498e444e94172382e05375a8 (03:51): % lsmod | grep multi",
        "51d4dc07498e444e94172382e05375a8 (03:51): %",
        "2a0be8d62ca9580cd38315202869a51a (03:51): modprobe ipt_multiport",
        "2a0be8d62ca9580cd38315202869a51a (03:51): should load it",
        "51d4dc07498e444e94172382e05375a8 (03:52): no modprobe on this critter ... insmod ok?",
        "2a0be8d62ca9580cd38315202869a51a (03:52): nod",
        "2a0be8d62ca9580cd38315202869a51a (03:52): modprob just also loads any dependencies first",
        "51d4dc07498e444e94172382e05375a8 (03:53): % insmod  ipt_multiport",
        "51d4dc07498e444e94172382e05375a8 (03:53): insmod: ipt_multiport.o: no module by that name found",
        "2a0be8d62ca9580cd38315202869a51a (03:53): not in /lib/iptables ?",
        "2a0be8d62ca9580cd38315202869a51a (03:53): er, actually, wrong location",
        "2a0be8d62ca9580cd38315202869a51a (03:54): that for the dynamic lib loaded into iptables command, not the kernel mod",
        "51d4dc07498e444e94172382e05375a8 (03:54): sec ... looking",
        "51d4dc07498e444e94172382e05375a8 (03:54): no *multiport* under /lib at all ...",
        "2a0be8d62ca9580cd38315202869a51a (03:55): ls /lib/modules/`uname -r`/kernel/net/ipv4/netfilter/",
        "51d4dc07498e444e94172382e05375a8 (03:55): aha ...",
        "51d4dc07498e444e94172382e05375a8 (03:55): libipt_multiport.so in /usr/lib/iptables",
        "2a0be8d62ca9580cd38315202869a51a (03:55): that's the dynamic user space lib, not the kernel module",
        "2a0be8d62ca9580cd38315202869a51a (03:56): see hwo your erro said it couldn't find  &quot;ipt_multiport.o&quot;  .o, not .so",
        "51d4dc07498e444e94172382e05375a8 (03:56): % ls /lib/modules/`uname -r`/kernel/net/ipv4/netfilter/",
        "51d4dc07498e444e94172382e05375a8 (03:56): ip_conntrack_h323.o       ip_conntrack_pptp.o       ip_nat_h323.o             ip_nat_pptp.o             ipt_geoip.o",
        "51d4dc07498e444e94172382e05375a8 (03:56): ip_conntrack_isakmp.o     ip_conntrack_proto_gre.o  ip_nat_isakmp.o           ip_nat_proto_gre.o",
        "51d4dc07498e444e94172382e05375a8 (03:56): ip_conntrack_l2tp.o       ip_conntrack_rtsp.o       ip_nat_l2tp.o             ip_nat_rtsp.o",
        "51d4dc07498e444e94172382e05375a8 (03:56): ip_conntrack_mms.o        ip_conntrack_sip.o        ip_nat_mms.o              ip_nat_sip.o",
        "2a0be8d62ca9580cd38315202869a51a (03:57): so it seems that your kernel update neglected to include the module, what distro is this that doesn't have modprobe? :)",
        "2a0be8d62ca9580cd38315202869a51a (03:57): oh, it's for lnksys",
        "2a0be8d62ca9580cd38315202869a51a (03:57): I guess they are tight on space",
        "51d4dc07498e444e94172382e05375a8 (03:57): actually the sveasoft variant",
        "51d4dc07498e444e94172382e05375a8 (03:57): Talisman v1.2, fwiw",
        "51d4dc07498e444e94172382e05375a8 (03:57): ok, so i've learned that it's missing:",
        "51d4dc07498e444e94172382e05375a8 (03:58): if i may borrow some wise-words, what specifically should i tell the devs there?",
        "51d4dc07498e444e94172382e05375a8 (03:58): simply to include the multiport module into the kernel?",
        "2a0be8d62ca9580cd38315202869a51a (03:58): so, the easy workaround, 7 --dport commands for each port instead of one --dports command, :)",
        "51d4dc07498e444e94172382e05375a8 (03:59): dkr: thx 4 the workaround -- hadn't thought of that",
        "51d4dc07498e444e94172382e05375a8 (03:59): (wonders if fwbuilder has that automagically wired in somewhere ...)",
        "2a0be8d62ca9580cd38315202869a51a (04:00): how much space do thos routers have, btw?",
        "2a0be8d62ca9580cd38315202869a51a (04:00): I've always just used a regular desktop with multiple NICs for my firewall/router, :)",
        "51d4dc07498e444e94172382e05375a8 (04:01): dkr: iirc, 16MB ram (changes with version ...)",
        "51d4dc07498e444e94172382e05375a8 (04:02): &quot;little linksys-es&quot; are easier to deploy in a neighborhood mesh, tho ... ;-)",
        "51d4dc07498e444e94172382e05375a8 (04:06): dkr: thx 4 the help.  off to flog the firmware devs.",
        "2a0be8d62ca9580cd38315202869a51a (04:07): iptables should give a more sane error than &quot;unknown error&quot;, too :)"
    ],
    "person_ids": [
        "33d9f0b2dcb9348449e56dbebf6bb7dc",
        "5f05b3ded4139f6a691da91429a957b9",
        "398f2bbd2b282c39c6500c2395ba56d5",
        "2a0be8d62ca9580cd38315202869a51a",
        "842c224c189130c3429ed776e02bae7d",
        "51d4dc07498e444e94172382e05375a8",
        "89d335ace62763c104082ee1becef58a"
    ]
}