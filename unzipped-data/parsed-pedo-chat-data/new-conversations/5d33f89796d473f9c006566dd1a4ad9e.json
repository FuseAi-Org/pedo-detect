{
    "id": "5d33f89796d473f9c006566dd1a4ad9e",
    "messages": [
        "898e82c94d7703e96f7ea83b31e0ac2b (02:01): niq: I'm just not well-versed enough in apr to know whether commenting out that destroy in dbd_close will have adverse effects -- or whether, logically, the pool will be destroyed at the right time anyway, being a subpool of the right one :)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:01): adverse as in memory leak or such ;)",
        "8dbc086b03263e15c54906fbf22120d6 (02:01): gotta run..... gonna work on it more tomorrow. Maybe open up a call with Novell.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:01): gsker: uhm ... now that is weird then. Try setting ServerName and ServerAlias inside that vhost.",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:03): mxs, you using any unusual settings, like for instance no DBDPersist?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:03): no, dbdpersist is at default setting",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:04): setting dbdmin=1, keep=2, max=10 and exptime=60",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:04): the double free is encountered once the connection closes, or very closely after that",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:04): (and the process will crash in that case)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:05): commenting out that one line fixes the crash (as far as I can see, anyway)",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:05): mxs, is that bug you?",
        "c125d87ad72dc099c443e95cc8578c2e (02:06): To working &lt;Directory... &gt; I have added following lines:     AuthPAM_Enabled on # enable mod_auth_pam     AuthPAM_FallThrough off  AuthType Basic     AuthName &quot;Secured&quot;  Require valid-user",
        "c125d87ad72dc099c443e95cc8578c2e (02:06): Problem is, it will not pass any of the existing account (throught ssh without any problem)",
        "c125d87ad72dc099c443e95cc8578c2e (02:06): Could anyone point me what should be wrong?",
        "7ac8f8cf65a7a0b4ea7635148640d197 (02:07): radone, what module are you using?",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:07): hmmm, his tracebacck is with prefork.  Are you on prefork too?",
        "7ac8f8cf65a7a0b4ea7635148640d197 (02:07): mod_authnz_external",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:07): radone: you might have forgotten to set a profile for apache in pam (i.e. /etc/pam.d/httpd)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:09): niq: yes, that particular installation is prefork with default settings",
        "c125d87ad72dc099c443e95cc8578c2e (02:09): pctony: module name is mod_auth_pam",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:09): I intend to try worker later on, but I started out with a default config ;)",
        "7ac8f8cf65a7a0b4ea7635148640d197 (02:09): mod_auth_pam?",
        "b0a90be919a9f920bb8ad2caca4e91f0 (02:09): mod_auth_pam is a module that requires access to one's system password file or <a href=\"http://pam.sourceforge.net/mod_auth_pam/\">http://pam.sourceforge.net/mod_auth_pam/</a>   recommends the use of  mod_authnz_external  as  mod_auth_pam is no longer developed/supported",
        "7ac8f8cf65a7a0b4ea7635148640d197 (02:09): radone ^ ^ ^",
        "c125d87ad72dc099c443e95cc8578c2e (02:10): thanks, I'll give it a try",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:11): what backend?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:11): niq: mod_dbd_mysql, and used by mod_authn_dbd and mod_authz_dbd",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:11): the logic in mod_dbd looks right to me, but ...",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:12): hmmm",
        "b0a90be919a9f920bb8ad2caca4e91f0 (02:12): things that make you go",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:12): does it make any difference of you move apr_pool_destroy before apr_dbd_close?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:12): fajita, forget hmmm",
        "b0a90be919a9f920bb8ad2caca4e91f0 (02:12): mxs: I forgot about hmmm.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:13): niq: have not tried, will do, sec",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:13): mxs++ //it's time someone cleared that annoyance :-)",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:15): that pool and destroy are there to clean up per-connection prepared statements",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:15): doing that after close may not be very clever",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:18): having trouble reproducing that crash right now, let me find the exact settings I used ;-)",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:18): hehe",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:19): I'll probably lose this thread - feel free to remind me",
        "c125d87ad72dc099c443e95cc8578c2e (02:21): well, fedora core 5 does not supports mod_authnz_external, only mod_auth_pam :(",
        "c125d87ad72dc099c443e95cc8578c2e (02:21): My /etc/pam.d/httpd consists of: #%PAM-1.0  auth     \\n  include      system-auth \\n account    include      system-auth",
        "c125d87ad72dc099c443e95cc8578c2e (02:21): but I have absolutely no idea what it means and if it is correct",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:24): niq: no, placing it above will not fix it.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:25): (reproduced the error with a very low maxclients setting)",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:25): when exactly does your crash occur?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:25): hard to figure out. The requests are successfully handled. The authentication works.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:26): so it has to be some time after the request (either immediately after, or when apache reaps the child due to MaxRequestsPerChild)",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:26): 'cos the bug report puts it at server shutdown",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:26): it is very likely child shutdown",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:27): let me verify that theory, sec",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:29): niq: ok, it seems to be related to child shutdown. When I set MaxRequestsPerChild to 1, the bug will occur. when I set it to 0, the error log stays quiet.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:30): (until I shutdown the server, when the bug occurs).",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:31): aha",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:31): I have a theory",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:31): you're on trunk, right?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:32): no, only mod_dbd is on trunk",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:32): at line 257",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:32): &quot;/* this pool is mostly so dbd_close can destroy the prepared stmts */&quot;",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:32): use rec-&gt;pool rather than pool in apr_pool_create",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:33): to make the dbd-conn pool a subpool of the dbd pool",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:33): it currently reads &quot;rv = apr_pool_create(&amp;rec-&gt;pool, pool);&quot;",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:33): yep.  Replace the second arg with rec-&gt;pool",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:33): oh",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:33): I mean svr-&gt;pool",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:35): rec-&gt;pool works as well.",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:35): too many pools here:-(",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:36): no, that's creating rec-&gt;pool as a subpool of [the second arg]",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:37): sorry, I had not changed to the crash-config ;)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:37): rv = apr_pool_create(&amp;rec-&gt;pool, svr-&gt;pool);  does not fix it.",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:38): bah",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:42): uhm. I might have an idea.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:42): rv = apr_pool_create(&amp;rec-&gt;pool, pool);",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:42): pool is a variable passed into dbd_construct",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:42): yep",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:42): in theory, if I did rv = apr_pool_create(&amp;rec-&gt;pool, rec-&gt;pool); should it fail ?",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:42): yep",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:43): it doesn't.",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:43): rec-&gt;pool seems to already be initialized",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:43): line 252 ...",
        "2ed8cebcb1b6df77f37a3c3f19b696d9 (02:44): how to add a cronjob to restart apache evrey 1hour?",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:44): oh, right.  no, shouldn't faIL",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:44): works with NULL and creates a top-level pool :-)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:44): ah ok :)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:44): so much for that theory, then :)",
        "e4d7ac934a5608807fe9130e93a22a50 (02:44): Babyboy: <a href=\"http://en.wikipedia.org/wiki/Crontab\">http://en.wikipedia.org/wiki/Crontab</a>",
        "2ed8cebcb1b6df77f37a3c3f19b696d9 (02:45): ty",
        "2ed8cebcb1b6df77f37a3c3f19b696d9 (02:45): and yow btw :)",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:45): though it does prevent the error from cropping up.",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:45): what happens if you do that?  does it still crash?",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:45): no, it does not",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:45): hmmm",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:45): for testing I currently have maxclients at 1 and maxrequestsperchild at 1, as well",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:46): that suggests to me the possibility of something deep within apr_pools",
        "2ed8cebcb1b6df77f37a3c3f19b696d9 (02:48): i hate working with vi",
        "898e82c94d7703e96f7ea83b31e0ac2b (02:48): Babyboy: set the EDITOR environment variable",
        "e4d7ac934a5608807fe9130e93a22a50 (02:48): pfft",
        "2ed8cebcb1b6df77f37a3c3f19b696d9 (02:48): where?",
        "b0a90be919a9f920bb8ad2caca4e91f0 (02:48): where are they from? Your apache error log",
        "7dcff74ec1c8812f6f9ca48fc780e3e2 (02:48): use cat"
    ],
    "person_ids": [
        "898e82c94d7703e96f7ea83b31e0ac2b",
        "8dbc086b03263e15c54906fbf22120d6",
        "7dcff74ec1c8812f6f9ca48fc780e3e2",
        "c125d87ad72dc099c443e95cc8578c2e",
        "7ac8f8cf65a7a0b4ea7635148640d197",
        "b0a90be919a9f920bb8ad2caca4e91f0",
        "2ed8cebcb1b6df77f37a3c3f19b696d9",
        "e4d7ac934a5608807fe9130e93a22a50"
    ]
}