{
    "id": "c48d6e88b0fbec2e122ccc3f28379ecd",
    "messages": [
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:13): Hi, I am wondering if I can block certain IP ports during certain times of day. My ISP gives me unlimited bandwidth overnight, but I only get 20GB a month during daytime. Can IPtables, and some script help me?",
        "de76c8e6cbbc3c1c44788a340cac141e (00:16): sure - have two rulesets &amp; a script to apply each",
        "de76c8e6cbbc3c1c44788a340cac141e (00:16): then use cron to run one script at the start of the night, and the other at the end",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:18): OK, going back a few steps, what kernel options and userspace kernel options do I need for this?",
        "de76c8e6cbbc3c1c44788a340cac141e (00:18): same for a normal iptables rulset. Are you using modules in your kernel?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:19): how no iptables options added so far, I don;t normally use modules, I include everything I need",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:19): have no",
        "de76c8e6cbbc3c1c44788a340cac141e (00:20): well, the easiest way to find what you need is to compile everything under iptables as a module, set up the rulesets, and see which modules you are using",
        "de76c8e6cbbc3c1c44788a340cac141e (00:20): otherwise, you'll need conntrack, xtables, the TCP/UDP matches, probably state match, ...",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:30): hmm, has the netfilter config changes in 2.6.18?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:30): using these docs: <a href=\"http://gentoo-wiki.com/HOWTO_Iptables_for_newbies\">http://gentoo-wiki.com/HOWTO_Iptables_for_newbies</a>",
        "de76c8e6cbbc3c1c44788a340cac141e (00:30): not since 2.6.16",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:31): yet, I don't see the same config",
        "de76c8e6cbbc3c1c44788a340cac141e (00:31): it's probably changed since that was updated",
        "de76c8e6cbbc3c1c44788a340cac141e (00:31): does that have xtables?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:31): all I get is DCCP, SCTP, TIPC",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:31): the docs have pre-2.6.16 and post 2.6.16",
        "de76c8e6cbbc3c1c44788a340cac141e (00:32): you see xtables then?",
        "de76c8e6cbbc3c1c44788a340cac141e (00:32): I use menuconfig, not whatever they have screenshots of",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:32): Nope",
        "de76c8e6cbbc3c1c44788a340cac141e (00:33): you have iptables enabled there?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): if it's directly under &quot;[*] Network packet filtering (replaces ipchains)  ---&gt; &quot;, then no",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): ?[*] Network packet filtering (replaces ipchains)  ---&gt;               ? ?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): ? ?    DCCP Configuration (EXPERIMENTAL)  ---&gt;                          ? ?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): ? ?    SCTP Configuration (EXPERIMENTAL)  ---&gt;                          ? ?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): ? ?    TIPC Configuration (EXPERIMENTAL)  ---&gt;                          ? ?",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:33): ? ?&lt; &gt; Asynchronous Transfer Mode (ATM) (EXPERIMENTAL)",
        "de76c8e6cbbc3c1c44788a340cac141e (00:33): one level up",
        "de76c8e6cbbc3c1c44788a340cac141e (00:33): oh",
        "de76c8e6cbbc3c1c44788a340cac141e (00:34): hit enter on [*] Network packet filtering (replaces ipchains)  ---&gt;",
        "de76c8e6cbbc3c1c44788a340cac141e (00:34): it'll give a submenu",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:34): Ahh, OK I got it,",
        "31aab5b5b24fec777d2ecaa3b1644de7 (00:34): Sorry for being thick.",
        "41c93b5308e0e3874571538ba4832a6d (00:58): Hey there, I'm having some problems with port forwarding. I've looked over and followed the instructions for prerouting, input,and forward....I can see bytes and packets increase for the given port when running `iptables -t nat -nvL` however the connection just times out",
        "85dcbd89f497160a5aa43c6fe96ed64a (00:59): dotcomguy2: just use a nice firewall configuration app or script...",
        "41c93b5308e0e3874571538ba4832a6d (00:59): I'm currently using uif, but I haven't had success using it either",
        "41c93b5308e0e3874571538ba4832a6d (00:59): I don't need anything comprehensive, I just need to forward about 3 ports.",
        "41c93b5308e0e3874571538ba4832a6d (01:01): Are there any apps/scripts you might recommend I try?",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:02): dotcomguy2: I have written a list in <a href=\"http://WWW.sabi.co.UK/Notes/linuxFwConfig.html\">http://WWW.sabi.co.UK/Notes/linuxFwConfig.html</a> that may be useful",
        "41c93b5308e0e3874571538ba4832a6d (01:02): Thank you, I will take a look.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:03): dotcomguy2: what worries me is that you have asked a question omitting several vital details. Which tends to imply that you don't consider them vital...",
        "41c93b5308e0e3874571538ba4832a6d (01:03): Okay, I was trying to be brief. If you don't mind I could go into more detail.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:04): dotcomguy2: of all those apps the most comprehensive is probably <a href=\"http://WWW.FwBuilder.org/\">http://WWW.FwBuilder.org/</a>",
        "41c93b5308e0e3874571538ba4832a6d (01:05): Which do you think would be the most minimal? I don't really want to replace the firewall script I already have, however I have not been able to configure the forwarding using it. Plus, documentation for it is sparse.",
        "41c93b5308e0e3874571538ba4832a6d (01:06): Or perhaps I should just replace it since it's not really proving adequate.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:07): dotcomguy2: a lot of people also use Shorewall or similar...",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:07): dotcomguy2: it all depends on how complicated your situation is.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:08): dotcomguy2: the usual situation in this channel is that most people asking questions don't really understand the questions they are asking. It goes downhill from there :-). That's why I usually recommend a GUI frontend.",
        "41c93b5308e0e3874571538ba4832a6d (01:08): hehe, I understand. In my case, gui doesn't apply.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:09): dotcomguy2: you can generate the config on a machine with GUI and load it on another.",
        "41c93b5308e0e3874571538ba4832a6d (01:09): This is a server directly connected to the Internet running various services and providing NAT for workstations on the local network. I'm trying to forward a port so that I can access a host within the local network.",
        "41c93b5308e0e3874571538ba4832a6d (01:09): I suppose I could",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:10): dotcomguy2: OK, this is a bit better.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:11): dotcomguy2: you need to DNAT of course, and ensure that there is some connection tracking or something else to let both incoming and outgoing packets thru.",
        "41c93b5308e0e3874571538ba4832a6d (01:12): Let me show you what I've tried if you don't mind",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:12): dotcomguy2: but that is a typical case handled by most firewall builders.",
        "41c93b5308e0e3874571538ba4832a6d (01:12): I keep thinking there's one rule or something I'm overlooking",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:13): dotcomguy2: I usually try not to look at people's configs, because it is usually impossible to imagine in one's head how they are going to play out. One needs as a rule 'tcpdump' both before and after the firewall to see what's going on.",
        "c3568d0d6c11b843519416fe288a8668 (01:13): /dev/null&quot;)",
        "41c93b5308e0e3874571538ba4832a6d (01:14): Well, for what it's worth: Trying to forward port 10000 to local IP 192.168.1.200. eth1 is external interface and eth0 is internal",
        "41c93b5308e0e3874571538ba4832a6d (01:14): iptables -A PREROUTING -t nat -i eth1 -p tcp --dport 10000 -j DNAT --to 192.168.1.200:10000",
        "41c93b5308e0e3874571538ba4832a6d (01:14): iptables -A INPUT -p tcp -m state --state NEW --dport 10000 -i eth1 -j ACCEPT",
        "41c93b5308e0e3874571538ba4832a6d (01:14): At this point I don't get 'connection refused' when connecting from the outside, but it times out",
        "41c93b5308e0e3874571538ba4832a6d (01:23): When I enable logging, it does get logged in syslog on the nat server",
        "41c93b5308e0e3874571538ba4832a6d (01:39): kernel: FW DNAT (-): IN=eth1 OUT=....",
        "41c93b5308e0e3874571538ba4832a6d (01:39): but nothing else",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:40): dotcomguy2: odds are that there are not return packets.",
        "41c93b5308e0e3874571538ba4832a6d (01:40): from the machine I'm trying to forward to?",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:40): dotcomguy2: try to 'tcpdump -nn -i eth0'",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:40): dotcomguy2: try to 'tcpdump -nn -i eth1'",
        "41c93b5308e0e3874571538ba4832a6d (01:40): ok",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:41): dotcomguy2: you want to see if packets get out of 'eth1' towards 192.168.1.200 and then if packets come back.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:41): dotcomguy2: try to 'tcpdump -nn -i eth1 port 10000'",
        "41c93b5308e0e3874571538ba4832a6d (01:41): also got an &quot;FW ACCEPT (-): IN=eth1 OUT=eth0 SRC=66.103.147.18 DST=192.168.1.200",
        "41c93b5308e0e3874571538ba4832a6d (01:41): K",
        "41c93b5308e0e3874571538ba4832a6d (01:42): ok, i got &quot;listening on eth1, link-type en10mb (ethernet), capture size 96 bytes",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:44): dotcomguy2: I am assuming you got a FORWARD rule to let the packets thru... I hope.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:44): dotcomguy2: note that INPUT is not FORWARD.",
        "41c93b5308e0e3874571538ba4832a6d (01:45): When trying to connect I get .... xx.xxx.xxx.xx &gt; myexternalip:10000",
        "41c93b5308e0e3874571538ba4832a6d (01:45): xx.xxx.xxx.xx is the ip from which I'm trying to connect which is outside my local network",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:45): dotcomguy2: is 'eth1' on your outside or inside?",
        "41c93b5308e0e3874571538ba4832a6d (01:45): I do have a forward rule, but it may not be correct.",
        "41c93b5308e0e3874571538ba4832a6d (01:46): eth1 is outside",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:46): dotcomguy2: and do you have a suitable FORWARD rule?",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:46): dotcomguy2: ahhh, then switch to 'eth0'.",
        "41c93b5308e0e3874571538ba4832a6d (01:47): k",
        "31aab5b5b24fec777d2ecaa3b1644de7 (01:47): Hi, making progress, but when I call, iptables-restore, it comes back with &quot; line 35 failed&quot;.  This is the COMMIT command.  Have I missed something?",
        "41c93b5308e0e3874571538ba4832a6d (01:47): Blissex,  I think I misunderstood...where do I switch to eth0: prerouting or forward?",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:48): dotcomguy2: the 'tcpdump'.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:48): dotcomguy2: you need also a FORWARD rule to let port 10000 thru, either in general or specifically between 'eth1' and 'eth0'.",
        "41c93b5308e0e3874571538ba4832a6d (01:49): Here's my forward:",
        "41c93b5308e0e3874571538ba4832a6d (01:49): 10ACCEPTlog  tcp  --  anywhere             anywhere            tcp dpt:10000",
        "41c93b5308e0e3874571538ba4832a6d (01:49): watching tcpdump -nn -i eth0 port 10000 now and going to try connecting again",
        "41c93b5308e0e3874571538ba4832a6d (01:50): I'm getting similar lines as before except it's from the ip I'm using outside to the local:",
        "41c93b5308e0e3874571538ba4832a6d (01:50): timestamp IP 66.103.xxx.xx &gt; 192.168.1.200:10000",
        "41c93b5308e0e3874571538ba4832a6d (01:51): just keeps trying",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:52): dotcomguy2: well, so the inner machine is not replying.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:52): dotcomguy2: or the replies are being dropped at 'eth0' because there is no rule for port 10000 from 'eth0' to 'eth1'.",
        "85dcbd89f497160a5aa43c6fe96ed64a (01:53): dotcomguy2: or perhaps you have no 'RELATED,ESTABLISHED' rule in FORWARD. who knows.",
        "41c93b5308e0e3874571538ba4832a6d (01:54): Well, I can connect to the inner machine from the router/server directly",
        "41c93b5308e0e3874571538ba4832a6d (01:54): hmm....I think I found something I overlooked",
        "41c93b5308e0e3874571538ba4832a6d (01:54): target     prot opt source               destination",
        "41c93b5308e0e3874571538ba4832a6d (01:54): STATEFORWARD  all  --  anywhere             anywhere",
        "41c93b5308e0e3874571538ba4832a6d (01:54): 10ACCEPTlog  tcp  --  anywhere             anywhere            tcp dpt:10000",
        "41c93b5308e0e3874571538ba4832a6d (01:54): 13DROPlog  all  --  anywhere             anywhere",
        "41c93b5308e0e3874571538ba4832a6d (01:55): that last drop is probably my problem",
        "41c93b5308e0e3874571538ba4832a6d (01:58): Okay, now the only thing in FORWARD is &quot;10acceptlog....tcp dpt:10000&quot; but no change from before",
        "41c93b5308e0e3874571538ba4832a6d (01:58): Is that forward rule incorrect?",
        "85dcbd89f497160a5aa43c6fe96ed64a (02:00): dotcomguy2: no idea.",
        "abe59155aa41ae19e4ea964e9dd4b200 (02:00): <a href=\"http://www.bagdadsoftware.de&quot;\">http://www.bagdadsoftware.de&quot;</a>)",
        "41c93b5308e0e3874571538ba4832a6d (02:06): hmm",
        "41c93b5308e0e3874571538ba4832a6d (02:07): Basically, I need to accept connections on that port, have a rule in PREROUTING and a FORWARD rule for that port. Is there anything I'm missing?",
        "41c93b5308e0e3874571538ba4832a6d (02:13): Oh well, must be going. I really appreciate your help. Thank you. :-)",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:13): Hi, when I try to use my IPTables rules, I get an errror, when the COMMIT line is called.  Can someone have a look at my ruleset please.  <a href=\"http://pastebin.ca/180106\">http://pastebin.ca/180106</a>",
        "2a0be8d62ca9580cd38315202869a51a (02:17): there is no such thing as &quot;an error&quot;,  there are only &quot;error messages&quot; which are a string of text that are supposed to give you a clue as to what the error is and that you should tell people trynig to help you. :)",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:17): eden linux # iptables-restore /etc/iptables.bak",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:17): iptables-restore: line 38 failed",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:17): line 38 failed, means jacksh1t, that's the commit line...",
        "2a0be8d62ca9580cd38315202869a51a (02:17): well, that's not an iptables error",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:18): not sure what I need to do, or where to do.  This IPTable lark seems very unfriendly....",
        "2a0be8d62ca9580cd38315202869a51a (02:19): you aren't using iptables, you are using a wrapper script around it. :)   one that I've never used, so I don't know what COMMIT means",
        "2a0be8d62ca9580cd38315202869a51a (02:19): it means nothing to iptables itself",
        "2a0be8d62ca9580cd38315202869a51a (02:20): maybe iptables-restore needs a newline at the end of the commit?",
        "2a0be8d62ca9580cd38315202869a51a (02:27): yep, that's the problem.  I ran iptables-save   removed the last newline after COMMIT as yu did, and ran iptables-restore which failed at the COMMIT line",
        "2a0be8d62ca9580cd38315202869a51a (02:29): it was actually ahrd to remove the last newline since I have me editors set to automatically add one at end of file to avoid problems just liek this. heh :)",
        "31aab5b5b24fec777d2ecaa3b1644de7 (02:38): hmm, it's not the COMMIT whitespace here, nothing stops the error.."
    ],
    "person_ids": [
        "31aab5b5b24fec777d2ecaa3b1644de7",
        "de76c8e6cbbc3c1c44788a340cac141e",
        "41c93b5308e0e3874571538ba4832a6d",
        "85dcbd89f497160a5aa43c6fe96ed64a",
        "c3568d0d6c11b843519416fe288a8668",
        "abe59155aa41ae19e4ea964e9dd4b200",
        "2a0be8d62ca9580cd38315202869a51a"
    ]
}