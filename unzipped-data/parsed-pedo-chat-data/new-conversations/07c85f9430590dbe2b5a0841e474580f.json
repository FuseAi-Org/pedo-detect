{
    "id": "07c85f9430590dbe2b5a0841e474580f",
    "messages": [
        "5edc67952782a06dd92093cba4d13750 (01:30): I'm trying to write a web accessible user interface to iptables to block IP addresses. Is there anyway to add a block on an IP address only if it doesn't already exist? (Or will I have to write my own routines to check). For example, I'll have a cronjob setup to read an external file of banned IP's and the script will add them to iptables (if needed).",
        "de76c8e6cbbc3c1c44788a340cac141e (01:32): if you wanted to, you could use ipset or recent to do the IP checking",
        "de76c8e6cbbc3c1c44788a340cac141e (01:33): ipset would be better for it, but requires a kernel patch, whilee recent is alreay in the kernel",
        "de76c8e6cbbc3c1c44788a340cac141e (01:34): you just echo ip &gt; /proc/net/ipt_recent/BLOCK; iptables -A INPUT -m recent --rcheck --name BLOCK -j DROP",
        "5edc67952782a06dd92093cba4d13750 (01:35): hmm, doesn't look like I have either of them (Debian 3.1)",
        "de76c8e6cbbc3c1c44788a340cac141e (01:35): really?",
        "de76c8e6cbbc3c1c44788a340cac141e (01:35): how did you test that?",
        "5edc67952782a06dd92093cba4d13750 (01:36): I just tried changing directories to /proc/net and there isn't any ipt_recent",
        "de76c8e6cbbc3c1c44788a340cac141e (01:37): of course, you probably don't have the module loaded",
        "de76c8e6cbbc3c1c44788a340cac141e (01:37): modprobe ipt_recent",
        "5edc67952782a06dd92093cba4d13750 (01:38): ok, now I've got it",
        "de76c8e6cbbc3c1c44788a340cac141e (01:38): you need to insert the rule first; it will create the files in the directory",
        "a5491860047ff8c28daa5d466333cd55 (01:52): I'm little confused about forward chain. Traffic passing in Forward is 1) SNAT from users or 2) Being DNAT into internal servers, right ? (anything else?)",
        "de76c8e6cbbc3c1c44788a340cac141e (01:55): it is anything that is routed by the machine - everything not destined for it, or generated by it",
        "a5491860047ff8c28daa5d466333cd55 (01:56): I understand that, but I cant think of any other form of traffic other than SNAT/DNAT? anything specific ?",
        "de76c8e6cbbc3c1c44788a340cac141e (01:56): consider a _normal_ router - all the traffic would go through without any NAT",
        "de76c8e6cbbc3c1c44788a340cac141e (01:57): or, if you had two local networks, traffic between the two would also go through FORWARD",
        "a5491860047ff8c28daa5d466333cd55 (01:59): hmm thanks ..",
        "a5491860047ff8c28daa5d466333cd55 (02:00): one more thing .. what are the recommended /proc settings? I know about tcp_syncookies &amp; rp_filter, anything else worth noticing ?",
        "de76c8e6cbbc3c1c44788a340cac141e (02:01): only other one I know of is /proc/sys/net/netfilter/ip_conntrack_tcp_loose - set it to zero about 20 minutes after a reboot of the router",
        "de76c8e6cbbc3c1c44788a340cac141e (02:01): that lets the router pick up already-established connections",
        "a5491860047ff8c28daa5d466333cd55 (02:02): duh! did I miss a message over that netsplit?! (I only got &quot;that lets the router pick up already-established connections&quot;)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:03): &gt; the only other one I know of is /proc/sys/net/netfilter/ip_conntrack_tcp_loose - set it to zero about 20 minutes after a reboot of the router",
        "a5491860047ff8c28daa5d466333cd55 (02:03): thnx ...",
        "a5491860047ff8c28daa5d466333cd55 (02:03): I am thinking rp_filter is useless as well, if I make FORWARD policy DROP, right?",
        "a5491860047ff8c28daa5d466333cd55 (02:04): and only forward packets, internal 2 output",
        "de76c8e6cbbc3c1c44788a340cac141e (02:04): rp_filter might still be useful - don't disable it unless you have a reason",
        "a5491860047ff8c28daa5d466333cd55 (02:04): just in case :)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:05): you are correct that it won't make any difference though",
        "a5491860047ff8c28daa5d466333cd55 (02:06): also, a rule blocking spoofed packets coming on public interface such as",
        "a5491860047ff8c28daa5d466333cd55 (02:07): iptables -A INPUT -i eth0 -s 192.168.0.0/24 -j DROP",
        "a5491860047ff8c28daa5d466333cd55 (02:07): is useless if I am using rp_filter, correct ?",
        "de76c8e6cbbc3c1c44788a340cac141e (02:07): I think so",
        "a5491860047ff8c28daa5d466333cd55 (02:07): thanks man ..",
        "a5491860047ff8c28daa5d466333cd55 (02:10): why would --state NEW, be better than --syn ? (if it is)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:11): it handles UDP, and it uses the conntrack instead of just the TCP flags",
        "a5491860047ff8c28daa5d466333cd55 (02:11): what's the meaning of (-s 0/0 -d 0/0 )",
        "de76c8e6cbbc3c1c44788a340cac141e (02:11): no meaning",
        "a5491860047ff8c28daa5d466333cd55 (02:12): iptables -A INPUT -p tcp -s 0/0 -d 0/0 --destination-port 80 --syn -j ACCEPT",
        "de76c8e6cbbc3c1c44788a340cac141e (02:12): is exactly identical to iptables -A INPUT -p tcp --dport 80 --syn -j ACCEPT",
        "a5491860047ff8c28daa5d466333cd55 (02:12): oh ok ..",
        "de76c8e6cbbc3c1c44788a340cac141e (02:13): otherwise, -s and -d specify soruce &amp; destination IPs",
        "a5491860047ff8c28daa5d466333cd55 (02:16): If I run a mailserver behind a firewall, I *have* to DNAT to the mail server, right? It is never accessible in any direct *forwarding* manner ?",
        "a5491860047ff8c28daa5d466333cd55 (02:17): perhaps maybe if the mailserver has a real IP?!",
        "de76c8e6cbbc3c1c44788a340cac141e (02:18): if the mailserver has a real IP, the router could route things to it",
        "de76c8e6cbbc3c1c44788a340cac141e (02:18): but the router would have to know the IP and have a route for it",
        "de76c8e6cbbc3c1c44788a340cac141e (02:18): (or the mailserver would need its own connection to the internet)",
        "a5491860047ff8c28daa5d466333cd55 (02:18): yeah ... so if it has a 192.168 IP, then I have to DNAT ?",
        "de76c8e6cbbc3c1c44788a340cac141e (02:19): yes",
        "a5491860047ff8c28daa5d466333cd55 (02:22): If I query my ISP DNS server, the reply is sent over UDP. Would this be considered (ESTABLISHED,RELATED) ?",
        "de76c8e6cbbc3c1c44788a340cac141e (02:22): ESTABLISHED",
        "d949efae795da71ef603b60b018d191c (02:22): hmmm... ESTABLISHED is the state of the TCP connection - it could also be FIN_WAIT or other things",
        "a5491860047ff8c28daa5d466333cd55 (02:23): maxine: so would an INPUT ESTABLISHED rule let it in ?",
        "d949efae795da71ef603b60b018d191c (02:23): kimo: wish i knew",
        "de76c8e6cbbc3c1c44788a340cac141e (02:23): maxine is a bot",
        "a5491860047ff8c28daa5d466333cd55 (02:24): danieldg: weird, UDP is connectionless !",
        "de76c8e6cbbc3c1c44788a340cac141e (02:24): but conntrack tracks it anyway",
        "a5491860047ff8c28daa5d466333cd55 (02:24): but how does it track it ? (packet timing?)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:24): yep, timing and port numbers",
        "a5491860047ff8c28daa5d466333cd55 (02:25): smart little genie :)",
        "a5491860047ff8c28daa5d466333cd55 (02:30): is there &quot; -j DENY&quot; !",
        "de76c8e6cbbc3c1c44788a340cac141e (02:30): -j DROP or -j REJECT?",
        "a5491860047ff8c28daa5d466333cd55 (02:30): yeah!",
        "a5491860047ff8c28daa5d466333cd55 (02:35): using custom chains, is purely for performance optimization, AFAIK, correct ?",
        "de76c8e6cbbc3c1c44788a340cac141e (02:35): there are other reasons too",
        "de76c8e6cbbc3c1c44788a340cac141e (02:35): but mostly yes",
        "a5491860047ff8c28daa5d466333cd55 (02:35): thanks ...",
        "a5491860047ff8c28daa5d466333cd55 (02:52): I'm presenting about iptables tomorrow, what are some interesting modules for netfilter ?? (I know about -m limit, recent)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:54): owner, for outbound filtering",
        "a5491860047ff8c28daa5d466333cd55 (02:54): who would put users on gateway machine :)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:55): well, you can have a firewall on a server... ;)",
        "de76c8e6cbbc3c1c44788a340cac141e (02:55): u32, for arbitrary packet inspection",
        "de76c8e6cbbc3c1c44788a340cac141e (02:56): maybe ipp2p",
        "de76c8e6cbbc3c1c44788a340cac141e (02:57): I think u32 and ipp2p require a kernel patch",
        "a5491860047ff8c28daa5d466333cd55 (02:58): thnx .. ipp2p does sound very interesting",
        "a5491860047ff8c28daa5d466333cd55 (03:01): just a weird question ... say I have webserver, and all other service are closed (nmap only finds port 80 open), why would a firewall still be important to run on such a host!!",
        "de76c8e6cbbc3c1c44788a340cac141e (03:01): an outbound firewall might be useful",
        "a5491860047ff8c28daa5d466333cd55 (03:01): why",
        "de76c8e6cbbc3c1c44788a340cac141e (03:02): it could prevent any outbound connections by the UID of the webserver",
        "de76c8e6cbbc3c1c44788a340cac141e (03:02): so when some script kidde finds an exploit on your server, he can't get it to download anything for him",
        "a5491860047ff8c28daa5d466333cd55 (03:04): yeah ... but most of the work goes into filtering input chain, and usually there is no server listening there. Seems like firewalling in general is not so important, unless someone forgets a server running by mistake! or am I horribly mistaken!",
        "de76c8e6cbbc3c1c44788a340cac141e (03:04): mostly, yes",
        "de76c8e6cbbc3c1c44788a340cac141e (03:04): it does help if you start a service by accident / is started by installer without your knowledge",
        "a5491860047ff8c28daa5d466333cd55 (03:05): :) You cant beleive how many people think of a FW as the network security silver bullet",
        "de76c8e6cbbc3c1c44788a340cac141e (03:06): kinda...",
        "de76c8e6cbbc3c1c44788a340cac141e (03:07): not running stuff as root is also good",
        "a5491860047ff8c28daa5d466333cd55 (03:07): yeah, but local priv escalation is not so difficult these days",
        "a5491860047ff8c28daa5d466333cd55 (03:08): I'm running oracle on real IPs and wish I could make a selinux policy for them. The policy is just darn hard to play with!",
        "a5491860047ff8c28daa5d466333cd55 (03:25): what's a use for mangle. I have never seen it doing anything useful!",
        "de76c8e6cbbc3c1c44788a340cac141e (03:25): changing TTL or TOS bits",
        "de76c8e6cbbc3c1c44788a340cac141e (03:25): using MARK for QoS",
        "a5491860047ff8c28daa5d466333cd55 (03:27): can u give a real world example please. ie match to what to perform what?",
        "a5491860047ff8c28daa5d466333cd55 (03:27): I've neber played with TOS or QoS :)",
        "a5491860047ff8c28daa5d466333cd55 (03:27): never*",
        "de76c8e6cbbc3c1c44788a340cac141e (03:27): <a href=\"http://lartc.org/howto/lartc.netfilter.html\">http://lartc.org/howto/lartc.netfilter.html</a>",
        "a5491860047ff8c28daa5d466333cd55 (03:28): thnx .."
    ],
    "person_ids": [
        "5edc67952782a06dd92093cba4d13750",
        "de76c8e6cbbc3c1c44788a340cac141e",
        "a5491860047ff8c28daa5d466333cd55",
        "d949efae795da71ef603b60b018d191c"
    ]
}