{
    "id": "b6b2651088d2e8165f3e8255b2854bd8",
    "messages": [
        "69b0d3dfe919a6b860a9fac82de52a7e (04:29): so i wonder how to define sandboxes",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:30): such that if you have document A with iframe containing document B with iframe containing document C",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:30): that:",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): 1. if A, B, and C are from the same origin, B can't play with C",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): hm wait",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): i was going to say that if B and C have hte same origin but aren't the same as A they should be able to talk",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): but no, that would still allow problems",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): so we really do want unique origins...",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): hmm",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:31): that makes it easier",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:32): HMM.",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:32): ponders",
        "65325d50b2e25aca54bc871b89758c9c (04:34): so I assume you are thinking sandboxes that still have script enabled?",
        "65325d50b2e25aca54bc871b89758c9c (04:34): (since for noscript iframes this would not matter)",
        "65325d50b2e25aca54bc871b89758c9c (04:35): maybe I should step back and ask what use cases you are targetting",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:35): actually same-origin matters even without scripts",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:35): a bunch of things use the origin concept",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:35): but yes, i am considering scripts too",
        "65325d50b2e25aca54bc871b89758c9c (04:35): like frame targetting?",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:35): yeah, that sometimes uses origin",
        "65325d50b2e25aca54bc871b89758c9c (04:35): I think the desired restrictions depend on the use cases",
        "65325d50b2e25aca54bc871b89758c9c (04:35): ones I can imagine:",
        "65325d50b2e25aca54bc871b89758c9c (04:36): - blog comments",
        "65325d50b2e25aca54bc871b89758c9c (04:36): - user-authored content in a profile on a social network site",
        "65325d50b2e25aca54bc871b89758c9c (04:36): - &quot;widgets&quot; embedded from off-site",
        "65325d50b2e25aca54bc871b89758c9c (04:36): - &quot;widgets&quot; hosted by the provider of the page containing them",
        "65325d50b2e25aca54bc871b89758c9c (04:36): - ads",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:37): comments and other user-contributed content, gadgets (same site and other site; including ads), and (not sandboxing but still &lt;iframe&gt; related) client-side includes are the main ones",
        "65325d50b2e25aca54bc871b89758c9c (04:37): ads are complicated because at least some ad networks consider it important to support frameless flash ads that overlay the content",
        "65325d50b2e25aca54bc871b89758c9c (04:37): but anything that can overlay the content is not properly sandboxed by definition",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:38): there are indeed various scenarios with varying levels of sandboxing",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:38): http://www.whatwg.org/specs/web-apps/current-work/sandbox has my current strawman proposal (cut and pasted from the start of the e-mail i'm writing; note that i've used past tense because it'll be past tense once i send the mail, but the spec isn't actually updated yet)",
        "65325d50b2e25aca54bc871b89758c9c (04:38): for comments you would like them to be able to size naturally and seem to be inline as far as the end-user is concerned, but they should not be able to css position outside their area",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:40): yeah the comments would be &lt;iframe sandbox=&quot;unrestricted-origin&quot; seamless src=&quot;data:text/html,(small html document)&quot;&gt;&lt;/iframe&gt;",
        "65325d50b2e25aca54bc871b89758c9c (04:41): I'm thinking about whether inheriting styles and applying outer stylesheets may be a security risk",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:41): in certain cases it is",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:41): in others not so much",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:41): i can't see how it could be in a script-limited blog comment case",
        "65325d50b2e25aca54bc871b89758c9c (04:42): I'm thinking for the comment use case and the user-generated content on hosted profile page use case",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:42): oh i have to disble forms too while i'm at it",
        "65325d50b2e25aca54bc871b89758c9c (04:42): and also plugins probably",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:42): yeah",
        "65325d50b2e25aca54bc871b89758c9c (04:42): (including Java)",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:43): updated sandbox file",
        "65325d50b2e25aca54bc871b89758c9c (04:43): I am nervous about the performance impact of using an iframe per comment with hundreds of comments",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:43): yeah me too",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:43): i'm not sure what else to do though",
        "65325d50b2e25aca54bc871b89758c9c (04:44): navigating the parent should be restricted (dunno if that falls out of other things), including back/forward",
        "65325d50b2e25aca54bc871b89758c9c (04:44): window sizing and positioning should be restricted",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:45): any browsing context navigation outside the sandbox is blocked",
        "65325d50b2e25aca54bc871b89758c9c (04:45): does embedding further subframes in the content need to be restricted?",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:45): though that does mean that links in comments won't work",
        "65325d50b2e25aca54bc871b89758c9c (04:46): or do they just inherit the sandbox restrictions already in effect?",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:46): i don't see why it should be, but they certainly are also sandboxed",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:46): and they're not in the same sandbox, either",
        "65325d50b2e25aca54bc871b89758c9c (04:47): links in blog comments not working is kind of a bummer",
        "65325d50b2e25aca54bc871b89758c9c (04:47): perhaps there should be a way to turn that on, since it can't be used as an annoyance in the noscript case",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:47): yeah",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:48): comments would now be &lt;iframe sandbox=&quot;unrestricted-origin force-links-to-parent&quot; seamless src=&quot;data:text/html,(small html document)&quot;&gt;&lt;/iframe&gt;",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:48): it's getting long",
        "65325d50b2e25aca54bc871b89758c9c (04:49): the keywords are a bit verbose",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:49): it's a security thing, i'm worried about making them too simple",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:49): i'm especially worried about making them sound like they _increase_ security",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:49): when all the keywords decrease it somewhow",
        "65325d50b2e25aca54bc871b89758c9c (04:49): perhaps there should be two addtributes",
        "65325d50b2e25aca54bc871b89758c9c (04:50): sandbox=&quot;&quot; or restrict=&quot;&quot; that turns everything off, and an allow=&quot;&quot; attribute to turn things back on selectively",
        "65325d50b2e25aca54bc871b89758c9c (04:50): or sandbox-exceptions=&quot;&quot;",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:51): well &quot;force-links-to-parent&quot; isn't really an exception or a restriction, it just changes the rules to send all user-activated links to the parent browsing context",
        "65325d50b2e25aca54bc871b89758c9c (04:51): you could achieve that with &lt;base target=&quot;parent&quot;&gt; and allowing targetted links to parent only",
        "65325d50b2e25aca54bc871b89758c9c (04:51): a bit more work but makes it strictly an exception, not a behavior change",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:51): (&lt;iframe seamless sandbox allow=&quot;...&quot; src=&quot;data:text/html,(small html document)&quot;&gt;&lt;/iframe&gt; makes sense, but i'm not sure what the keywords would be)",
        "65325d50b2e25aca54bc871b89758c9c (04:52): though if it is not a restriction or an exception perhaps it should be a separate attribute like seamless",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:52): well the idea is that you can allow whatever random content in the sandbox as you want",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:52): so i'm not sure i want to be poking &lt;base&gt; into it",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:52): ooo",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:52): wait!",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:52): it can just be part of seamless' behaviour!",
        "65325d50b2e25aca54bc871b89758c9c (04:52): for the comment use case presumably the data: URL is generated by software and the user's comment does not have &lt;html&gt; or &lt;body&gt;?",
        "65325d50b2e25aca54bc871b89758c9c (04:52): oh interesting",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:53): comments would now be &lt;iframe sandbox=&quot;unrestricted-origin&quot; seamless src=&quot;data:text/html,(small html document)&quot;&gt;&lt;/iframe&gt; again",
        "65325d50b2e25aca54bc871b89758c9c (04:53): is it ever useful to allow gadgets to navigate the parent or open a window?",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:53): probably, but i want to start with as small a set of allowed behaviours as possible",
        "65325d50b2e25aca54bc871b89758c9c (04:59): I guess for gadgets, anything forbidden can be selectively exposed via postMessage",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:59): eah",
        "69b0d3dfe919a6b860a9fac82de52a7e (04:59): y",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): maybe seamless should base its origin determination on the &quot;real&quot; origin, not the origin affected by sandbox=&quot;&quot;",
        "65325d50b2e25aca54bc871b89758c9c (05:01): 69b0d3dfe919a6b860a9fac82de52a7e: i think the seamless navigation rule should only apply to navigations triggered by the content of the iframe",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): as opposed to what?",
        "65325d50b2e25aca54bc871b89758c9c (05:01): 69b0d3dfe919a6b860a9fac82de52a7e: if the parent doc navigates a seamless iframe it should not navigate itself",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): hm, that makes things more complex",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): why would you use target=&quot;&quot; on a seamless iframe?",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): why not just change .data?",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:01): or .src",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:02): or whatever",
        "65325d50b2e25aca54bc871b89758c9c (05:02): changing .src is a navigation",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:02): not per spec",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:02): oh actually it is",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:02): nevermind",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:02): i'm thinking of &lt;object&gt;",
        "65325d50b2e25aca54bc871b89758c9c (05:02): well put it this way, changing iframe.src, changing iframe.contentWindow.location, and targetted link aimed at iframe all go at the same code path",
        "65325d50b2e25aca54bc871b89758c9c (05:02): at least in WebKit",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): yeah",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): spec too",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): ok",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): well",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): i could just do it for &lt;a&gt; links",
        "65325d50b2e25aca54bc871b89758c9c (05:03): knowing the source frame of a navigation is not a big deal",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): i guess",
        "65325d50b2e25aca54bc871b89758c9c (05:03): we always have to know anyway",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:03): though what do you call the source if someone from another iframe clicks a link using .click() ?",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:04): or what if frame A calls .click() on a link in frame B which has a target=&quot;&quot; to A, which is seamless?",
        "65325d50b2e25aca54bc871b89758c9c (05:04): I would say only cases where the source frame is the seamless frame itself should get retargetted",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:05): sure but what is the source frame in that example?",
        "65325d50b2e25aca54bc871b89758c9c (05:06): I don't know in general what a cross-frame click() call on a link considers the source frame",
        "65325d50b2e25aca54bc871b89758c9c (05:06): presumably something has to define which it is in any case",
        "65325d50b2e25aca54bc871b89758c9c (05:07): I don't think it matters which is chosen from security POV",
        "65325d50b2e25aca54bc871b89758c9c (05:07): since A has to have unrestricted origin in your scenario and thus could just modify B to do something bad",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:09): well i've never had to define it before now :-)",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:09): but i agree it doesn't really matter much",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:09): so long as it is defined",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:10): i guess i'll just add an &quot;argument&quot; to the &quot;navigate&quot; algorithm and make all the call sites say what the source is",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:12): defines the term &quot;source browsing context&quot;",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:12): (better terms welcome)",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:13): hm, this causes &lt;meta http-equiv=refresh&gt; inside a seamless iframe to navigate the parent iframe",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:14): oh hey, we do need this, to define .referer better",
        "69b0d3dfe919a6b860a9fac82de52a7e (05:14): :-)"
    ],
    "person_ids": [
        "69b0d3dfe919a6b860a9fac82de52a7e",
        "65325d50b2e25aca54bc871b89758c9c"
    ]
}