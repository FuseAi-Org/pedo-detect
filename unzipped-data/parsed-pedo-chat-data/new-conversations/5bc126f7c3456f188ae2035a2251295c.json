{
    "id": "5bc126f7c3456f188ae2035a2251295c",
    "messages": [
        "f0189780fb5d774ab5ab314ea3126625 (04:33): I just need a quick little rule that will allow me to block DHCP Offers at the router...",
        "f0189780fb5d774ab5ab314ea3126625 (04:33): I tried -i eth0 -p udp --dport 67:68 -j DROP",
        "de76c8e6cbbc3c1c44788a340cac141e (04:33): maxine: block port",
        "d949efae795da71ef603b60b018d191c (04:33): hmmm... block port is iptables -A INPUT -p tcp --dport $port -j REJECT; use FORWARD if it's for machines behind the firewall",
        "de76c8e6cbbc3c1c44788a340cac141e (04:33): you probably want OUTPUT, if this rule is on the DHCP server",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): no, this rule is on the router",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): I have 2 networks",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): my dad's, and mine",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): my dad's network runs dhcp, but I don't want it bleeding over into my network (which for some reason, it is)",
        "de76c8e6cbbc3c1c44788a340cac141e (04:34): are they bridged?",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): I have my own dhcp server",
        "f0189780fb5d774ab5ab314ea3126625 (04:34): no, they're not",
        "de76c8e6cbbc3c1c44788a340cac141e (04:35): it shouldn't be able to leak. Checked the cables?",
        "f0189780fb5d774ab5ab314ea3126625 (04:35): about to now...",
        "f0189780fb5d774ab5ab314ea3126625 (04:36): cables seem ok...",
        "f0189780fb5d774ab5ab314ea3126625 (04:37): that's weird",
        "de76c8e6cbbc3c1c44788a340cac141e (04:37): the networks are on different switches?",
        "f0189780fb5d774ab5ab314ea3126625 (04:37): a managed switch",
        "f0189780fb5d774ab5ab314ea3126625 (04:37): so, yes",
        "f0189780fb5d774ab5ab314ea3126625 (04:37): it doesn't do vlans, it's more of a partitioning scheme",
        "f0189780fb5d774ab5ab314ea3126625 (04:37): they're on seperate partitions",
        "de76c8e6cbbc3c1c44788a340cac141e (04:38): you're sure that is working correctly then?",
        "f0189780fb5d774ab5ab314ea3126625 (04:39): yeah, they're all partitioned correctly...",
        "f0189780fb5d774ab5ab314ea3126625 (04:40): wait a sec... damn, I may have just b0rked something. I'll be back",
        "f0189780fb5d774ab5ab314ea3126625 (04:40): thanks",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:47): hi i'm having problems with a rule i've added",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:47): it was working but now it doesn't seem to be",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:47): they're listed in iptables -l",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:47): i've tried flushing and re-adding to no avail",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:47): can anyone help?",
        "de76c8e6cbbc3c1c44788a340cac141e (04:48): what's the rule, and what's the problem",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:51): ok i have a vmware server running on a machine and i wanted to forward a port to it",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): 81 on the host to 80 on the virtual machine that has an ip of 172.16.208.128",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): on the server i set the following rule",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): iptables -t nat -A PREROUTING -p tcp -i eth0 -d 87.106.13.213 --dport 81 -j DNAT --to 172.16.208.128:80",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): iptables -A FORWARD -p tcp -i eth0 -d 172.16.208.128 --dport 80 -j ACCEPT",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): in iptables --list it's showing",
        "61a625a3bb5e6683fc41dbd7557eb050 (04:52): but i can't telnet to port 81 on 87.106.13.213 :(",
        "f0189780fb5d774ab5ab314ea3126625 (04:54): danieldg, well, apparently, unless there's another wireless adapter in my house I don't know about (there isn't) dhcp is somehow leaking through my router",
        "f0189780fb5d774ab5ab314ea3126625 (04:54): if you have a suggestion I'll try it, otherwise, I think I'm gonna wait on it...",
        "f0189780fb5d774ab5ab314ea3126625 (04:55): and using -j reject on port 67 and 68 isn't working either... for some odd reasson...",
        "de76c8e6cbbc3c1c44788a340cac141e (04:55): it's not going through your router",
        "f0189780fb5d774ab5ab314ea3126625 (04:57): ok, so then I just have to track down a rogue cable somewhere?",
        "de76c8e6cbbc3c1c44788a340cac141e (04:57): probably",
        "f0189780fb5d774ab5ab314ea3126625 (04:57): is there any way I COULD push dhcp through a router, or would that require a dhcpd repeater",
        "de76c8e6cbbc3c1c44788a340cac141e (04:57): you could try unplugging them all, and plug them in one by one to see which one causes the problem, but that's likely to be disruptive",
        "f0189780fb5d774ab5ab314ea3126625 (04:58): heh, disruptions are ok, I run the network, my family is at my mercy. though I'll probably try that around 2amish",
        "f0189780fb5d774ab5ab314ea3126625 (04:58): thanks",
        "f0189780fb5d774ab5ab314ea3126625 (04:58): I appreciate it. so I assume then that DHCP runs with a TTL of 1 on its packets?",
        "de76c8e6cbbc3c1c44788a340cac141e (04:58): effectively. It uses broadcast",
        "f0189780fb5d774ab5ab314ea3126625 (04:58): ok",
        "f0189780fb5d774ab5ab314ea3126625 (04:59): I should remember this, I just tend to second guess myself",
        "f0189780fb5d774ab5ab314ea3126625 (04:59): thanks again",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:07): any ideas then dan? :)",
        "de76c8e6cbbc3c1c44788a340cac141e (05:08): InKubus: vmware may be acting wierd with the DNAT rule... try adding an SNAT",
        "de76c8e6cbbc3c1c44788a340cac141e (05:08): maxine: snat needed",
        "d949efae795da71ef603b60b018d191c (05:08): snat needed is forwarding a connection to a host where the return packets do not pass through the iptables  machine, you must change the source address with SNAT (or MASQUERADE) or the connection will fail. See &lt;dmz example&gt; for an example rule, or <a href=\"http://iptables-tutorial.frozentux.net/chunkyhtml/x4013.html\">http://iptables-tutorial.frozentux.net/chunkyhtml/x4013.html</a> for more info",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:10): ok groovy",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:10): brb gonna have a read",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:10): thanks dan",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:17): hmm dan",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:17): i don't have a postrouting chain?",
        "de76c8e6cbbc3c1c44788a340cac141e (05:17): iptables -t nat -vL",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:17): aha :)",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:18): iptables -t nat -A POSTROUTING -p tcp --dst 81 --dport 80 -j SNAT --to-source 172.16.208.128",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:18): look about right?",
        "de76c8e6cbbc3c1c44788a340cac141e (05:20): --dst is the IP, not the port",
        "de76c8e6cbbc3c1c44788a340cac141e (05:20): otherwise, yes",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:20): thanks",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:21): hmm",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:21): isn't that mixed up?",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:21): --dst should be the destination surely?",
        "de76c8e6cbbc3c1c44788a340cac141e (05:22): destination IP",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:22): this example uses the lan ip (which i'm guessing was the destination) as the --to-source",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:22): so you specify the same ip twice?",
        "cce85e723d6886c97e13c3a7adae9841 (05:26): What is a good nmap line I can use to scan myself on every port? I've never used nmap before. But I wanted to test my iptable rules",
        "de76c8e6cbbc3c1c44788a340cac141e (05:27): scanning yourself is usually not the greatest way to test",
        "de76c8e6cbbc3c1c44788a340cac141e (05:27): but you could just &quot;nmap 127.0.0.1&quot;",
        "cce85e723d6886c97e13c3a7adae9841 (05:29): danieldg: I'm scanning from the outside",
        "de76c8e6cbbc3c1c44788a340cac141e (05:29): ah",
        "673d7d497cb7c30e46ce951bc321aafd (05:30): nmap -v -A -P0 ipnumber",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:34): danieldg: iptables -t nat -A POSTROUTING -p tcp --dst 172.16.208.128 --dport 80 -j SNAT --to-source 172.16.208.128 doesn't seem to be working :(",
        "de76c8e6cbbc3c1c44788a340cac141e (05:35): oh - the --to-source needs to be the source of the iptables box",
        "de76c8e6cbbc3c1c44788a340cac141e (05:35): (the primary IP)",
        "de76c8e6cbbc3c1c44788a340cac141e (05:36): and --dst is the host which was DNATed",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:36): okies",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:36): so i should -F before i do this?",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:37): i can't connect to 172.16.205.128 on port 80 now",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:37): but i can on 21",
        "de76c8e6cbbc3c1c44788a340cac141e (05:37): yes, iptables -t nat -F",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:38): ok i can connect on 80 now",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:38): so apply my normal prerouting/forward rules",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:39): then add the postroute",
        "de76c8e6cbbc3c1c44788a340cac141e (05:39): yes",
        "aee0fd5481d77aae3616ab25971b3a9d (05:39): hi all",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:41): still no luck i'm afraid",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:41): iptables -t nat -A PREROUTING -p tcp -i eth0 -d 87.106.13.213 --dport 81 -j DNAT --to 172.16.208.128:80",
        "61a625a3bb5e6683fc41dbd7557eb050 (05:41): iptables -A FORWARD -p tcp -i eth0 -d 172.16.208.128 --dport 80 -j ACCEPT"
    ],
    "person_ids": [
        "f0189780fb5d774ab5ab314ea3126625",
        "de76c8e6cbbc3c1c44788a340cac141e",
        "d949efae795da71ef603b60b018d191c",
        "61a625a3bb5e6683fc41dbd7557eb050",
        "cce85e723d6886c97e13c3a7adae9841",
        "673d7d497cb7c30e46ce951bc321aafd",
        "aee0fd5481d77aae3616ab25971b3a9d"
    ]
}